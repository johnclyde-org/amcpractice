<!DOCTYPE html>
<html>
<head>
    <title>Online Test</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #timer { position: fixed; top: 10px; right: 10px; font-size: 20px; color: blue; }
        .question {
            display: inline-block;
            border: 1px solid #999999;
            width: 26px;
            height: 31px;
            color: #666666;
            text-align: center;
            margin: 5px;
            line-height: 31px;
            cursor: pointer;
            background-color: #fff;
            font-size: 16px;
        }
        .question:hover {
            background-color: #f0f0f0;
        }
        #testSelectModal {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
            z-index: 1000;
        }
        #reviewSection { margin: 10px; }
        /* Additional styles as needed */
    </style>
</head>
<body>
    <div id="timer"></div>
    <button id="toggleTimer">Unpause</button>
    <button id="importTest">Import Test</button>
    <button id="switchTest">Switch Test</button>

    <div id="testSelectModal" style="display:none;">
        <select id="testSelect"></select>
        <button id="confirmTestSelection">Select</button>
        <button id="cancelTestSelection">Cancel</button>
    </div>

    <div id="reviewSection">
        <strong>Review</strong>
        <div id="questions">
            <!-- Questions will be added here by JavaScript -->
        </div>
    </div>
    <script>
        var timerRunning = false;
        var seconds = 0;
        var interval;

        function updateTimer() {
            var currentTime = new Date();
            document.getElementById("timer").innerText = "Current Time: " + currentTime.toLocaleTimeString() +
                ", Elapsed Time: " + seconds + " seconds";
            if (timerRunning) seconds++;
        }

        function toggleTimer() {
            if (!timerRunning) {
                interval = setInterval(updateTimer, 1000);
                timerRunning = true;
                document.getElementById("toggleTimer").innerText = "Pause";
            } else {
                timerRunning = false;
                document.getElementById("toggleTimer").innerText = "Unpause";
            }
        }

        document.getElementById("toggleTimer").addEventListener("click", toggleTimer);

        function navigateToQuestion(questionNumber) {
            console.log("Navigating to question " + questionNumber);
            // Replace with your actual navigation logic
        }

        document.getElementById("importTest").addEventListener("click", function() {
            var jsonInput = prompt("Paste JSON for the new test:");
            if (jsonInput === null) {
                // Do nothing.
            } else if (jsonInput) {
                try {
                    var jsonData = JSON.parse(jsonInput);
                    var existingTests = localStorage.getItem("testData");
                    var tests = existingTests ? JSON.parse(existingTests) : [];
                    tests.push(jsonData);
                    localStorage.setItem("testData", JSON.stringify(tests));
                    alert("Test imported successfully.");
                } catch (error) {
                    alert("Error parsing JSON: " + error);
                }
            } else {
                alert("No JSON input.");
            }
        });

        function populateTestDropdown() {
            var tests = JSON.parse(localStorage.getItem("testData") || "[]");
            var testSelect = document.getElementById("testSelect");
            testSelect.innerHTML = ""; // Clear existing options
            tests.forEach(function(test, index) {
                var option = document.createElement("option");
                option.value = index;
                option.textContent = test.set_label || `Test ${index + 1}`;
                testSelect.appendChild(option);
            });
        }

        document.getElementById("switchTest").addEventListener("click", function() {
            populateTestDropdown();
            document.getElementById("testSelectModal").style.display = "block";
        });

        document.getElementById("cancelTestSelection").addEventListener("click", function() {
            document.getElementById("testSelectModal").style.display = "none";
        });

        var currentTestData = null;

        function generateQuestions() {
            if (!currentTestData) {
                return;
            }
            var questionsContainer = document.getElementById("questions");
            questionsContainer.innerHTML = '';
            currentTestData.problems.forEach(function(problem) {
                var questionSpan = document.createElement("span");
                questionSpan.className = "question";
                questionSpan.innerText = problem.label;
                questionSpan.onclick = function() { navigateToQuestion(this.innerText); };
                questionsContainer.appendChild(questionSpan);
            });
        }

        document.getElementById("confirmTestSelection").addEventListener("click", function() {
            var selectedTestIndex = document.getElementById("testSelect").value;
            var tests = JSON.parse(localStorage.getItem("testData") || "[]");
            if (tests[selectedTestIndex]) {
                currentTestData = tests[selectedTestIndex];
                console.log("Current test set to:", currentTestData.set_label);
                generateQuestions();
                document.getElementById("testSelectModal").style.display = "none";
            }
        });

        generateQuestions();
        updateTimer(); // Initialize the timer display
    </script>
</body>
</html>
